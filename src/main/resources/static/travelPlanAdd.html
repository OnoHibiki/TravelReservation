<!DOCTYPE html>
<html>
<head>
    <title>æ—…è¡Œãƒ—ãƒ©ãƒ³è¿½åŠ </title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/style.css">
    <script>
        async function addTravelPlan() {
            const travelPlanData = {
                tourName: document.getElementById("tour_name").value, 
                hotel: document.getElementById("hotel").value,
                destination: document.getElementById("destination").value,
                price: parseInt(document.getElementById("price").value, 10) || 0, // ğŸ› ï¸ æ•°å€¤å¤‰æ›ã®å®‰å…¨å¯¾ç­–
                description: document.getElementById("description").value,
                departureDate: document.getElementById("departure_date").value, // âœ¨ å‡ºç™ºæ—¥
                returnDate: document.getElementById("return_date").value // âœ¨ å¸°ç€æ—¥
            };

            try {
                const response = await fetch("/travel-plans", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(travelPlanData)
                });

                if (response.ok) {
                    alert("ãƒ—ãƒ©ãƒ³è¿½åŠ æˆåŠŸï¼");
                    await fetchTravelPlans(); // ğŸ”¹ ç™»éŒ²å¾Œã«æ—…è¡Œãƒ—ãƒ©ãƒ³ä¸€è¦§ã‚’æ›´æ–°
                    document.getElementById("tour_name").value = "";
                    document.getElementById("hotel").value = "";
                    document.getElementById("destination").value = "";
                    document.getElementById("price").value = "";
                    document.getElementById("description").value = "";
                    document.getElementById("departure_date").value = "";
                    document.getElementById("return_date").value = "";
                } else {
                    const errorData = await response.json(); // ğŸ› ï¸ ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ã‚’å–å¾—
                    alert("è¿½åŠ å¤±æ•—: " + (errorData.message || "åŸå› ä¸æ˜ã®ã‚¨ãƒ©ãƒ¼"));
                    console.error("ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼:", errorData);
                }
            } catch (error) {
                alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
                console.error("é€šä¿¡ã‚¨ãƒ©ãƒ¼:", error);
            }
        }

        // æ—…è¡Œãƒ—ãƒ©ãƒ³ä¸€è¦§å–å¾—å‡¦ç†
        async function fetchTravelPlans() {
            const planList = document.getElementById("planList");
            planList.innerHTML = "<p>æ—…è¡Œãƒ—ãƒ©ãƒ³ã‚’å–å¾—ä¸­...</p>"; // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º

            try {
                const response = await fetch("/travel-plans");
                const plans = await response.json();

                planList.innerHTML = ""; // æ—¢å­˜ã®ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
                plans.forEach(plan => {
                    const listItem = document.createElement("li");
                    listItem.textContent = `ãƒ—ãƒ©ãƒ³å: ${plan.tourName} - æ–™é‡‘: ${plan.price} å††`;
                    planList.appendChild(listItem);
                });
            } catch (error) {
                console.error("æ—…è¡Œãƒ—ãƒ©ãƒ³ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
                planList.innerHTML = "<p>æ—…è¡Œãƒ—ãƒ©ãƒ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>";
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«æ—…è¡Œãƒ—ãƒ©ãƒ³ä¸€è¦§ã‚’å–å¾—
        document.addEventListener("DOMContentLoaded", fetchTravelPlans);
    </script>
</head>
<body>
    <h1>æ—…è¡Œãƒ—ãƒ©ãƒ³è¿½åŠ </h1>
    
    <label for="tour_name">ãƒ„ã‚¢ãƒ¼å</label><br>
    <input type="text" id="tour_name" placeholder="ãƒ„ã‚¢ãƒ¼å" required><br><br>
    
    <!-- ãƒ›ãƒ†ãƒ« -->
    <label for="hotel">ãƒ›ãƒ†ãƒ«</label><br>
    <input type="text" id="hotel" placeholder="ãƒ›ãƒ†ãƒ«å"><br><br>
    
    <!-- ç›®çš„åœ° -->
    <label for="destination">ç›®çš„åœ°</label><br>
    <input type="text" id="destination" placeholder="ç›®çš„åœ°"><br><br>
    
    <!-- æ–™é‡‘ -->
    <label for="price">æ–™é‡‘</label><br>
    <input type="number" id="price" placeholder="æ–™é‡‘"><br><br>

    <!-- å‡ºç™ºæ—¥ ã¾ã ã†ã¾ãã„ã‹ãªã„
    <label for="departure_date">å‡ºç™ºæ—¥</label><br>
    <input type="date" id="departure_date" required><br><br> 
    -->
    <!-- å¸°ç€æ—¥ ã¾ã ã†ã¾ãã„ã‹ãªã„
    <label for="return_date">å¸°ç€æ—¥</label><br>
    <input type="date" id="return_date" required><br><br>
    -->

    <!-- èª¬æ˜ -->
    <label for="description">èª¬æ˜</label><br>
    <textarea id="description" placeholder="èª¬æ˜" rows="4" cols="50"></textarea><br><br>
    
    <button onclick="addTravelPlan()">è¿½åŠ </button>
    <a href="index.html">TOPã¸æˆ»ã‚‹</a>

    <h2>ç™»éŒ²æ¸ˆã¿æ—…è¡Œãƒ—ãƒ©ãƒ³ä¸€è¦§</h2>
    <ul id="planList">
        <p>æ—…è¡Œãƒ—ãƒ©ãƒ³ã‚’å–å¾—ä¸­...</p>
    </ul>
</body>
</html>
