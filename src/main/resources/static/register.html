<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/style.css">
    <title>æ–°è¦é¡§å®¢ç™»éŒ²</title>
    <script>
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²å‡¦ç†
        async function registerUser() {
            const name = document.getElementById("name").value;
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            const role = document.getElementById("role").value;
            
            const response = await fetch("/users", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, email, password, role })
            });
            if (response.ok) {
                alert("ç™»éŒ²æˆåŠŸï¼");
                await fetchUsers(); // ğŸ”¹ æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆã‚’å–å¾—
                document.getElementById("name").value = "";
                document.getElementById("email").value = "";
                document.getElementById("password").value = "";
                document.getElementById("role").value = "é¡§å®¢";
            } else {
                alert("ç™»éŒ²å¤±æ•—...");
            }
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—å‡¦ç†
        async function fetchUsers() {
            const userList = document.getElementById("userList");
            userList.innerHTML = "<p>ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ä¸­...</p>"; // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º

            try {
                const response = await fetch("/users");
                const users = await response.json();

                userList.innerHTML = ""; // æ—¢å­˜ã®ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
                users.forEach(user => {
                    const listItem = document.createElement("li");
                    listItem.textContent = `ID: ${user.id}, åå‰: ${user.name}, ãƒ¡ãƒ¼ãƒ«: ${user.email}`;
                    userList.appendChild(listItem);
                });
            } catch (error) {
                console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
                userList.innerHTML = "<p>ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>";
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’å–å¾—
        document.addEventListener("DOMContentLoaded", fetchUsers);
    </script>
</head>
<body>
    <h1>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²</h1>
    <input type="text" id="name" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" required><br><br>
    <input type="email" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" required><br><br>
    <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"><br><br>
    
    <label for="role">å½¹å‰²:</label>
    <select id="role" required>
        <option value="é¡§å®¢">user</option>
        <option value="å¾“æ¥­å“¡">admin</option>
    </select><br><br>

    <button onclick="registerUser()">ç™»éŒ²</button>
    <a href="index.html">TOPã¸æˆ»ã‚‹</a>

    <h2>ç™»éŒ²æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</h2>
    <ul id="userList">
        <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ä¸­...</p>
    </ul>
</body>
</html>
